<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Interactive Dashboard</title>
    <style>
.card {
  width: 100%;
  margin-right: 10px; /* Menentukan margin antara card */
}
.carousel-item {
  display: flex; /* Mengubah display ke flex */
  justify-content: space-between; /* Membuat card sejajar dan memberikan jarak antara card */
}
#carousel-inner {
  max-width: 100%;
}

    </style>
    <!-- Include Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <!-- Include Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="#">Dashboard</a>
      <button
        class="navbar-toggler"
        type="button"
        data-toggle="collapse"
        data-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto" style=" margin-left: 15px;">
          <li class="nav-item">
            <a class="nav-link" href="#">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">ABOUT US</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">ELECTRICAL EQUIPMENT</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">ARTICLE</a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="container-fluid">
      <h1 class="mt-4" style="text-align: center">Hetrik Dashboard</h1>
      <div class="row">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Total Pelanggan</h5>
              <p class="card-text" id="totalPelanggan">5000</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Total Barang</h5>
              <p class="card-text" id="totalBarang">Loading...</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Daya Bangunan</h5>
              <p class="card-text">2500</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Total Listrik Hemat</h5>
              <p class="card-text">50000 kWh</p>
            </div>
          </div>
        </div>
      </div>

      <div class="row mt-4">
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Grafik Barang</h5>
              <canvas id="barangChart" width="400" height="200"></canvas>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Grafik Listrik Hemat</h5>
              <canvas id="electricityChart" width="400" height="200"></canvas>
            </div>
          </div>
        </div>
      </div>

      

      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

<div class="container">
  <h1 class="mt-4" style="text-align: center"> Electrical  Equipment </h1>

  <div id="carouselExample" class="carousel slide mt-4" data-ride="carousel">
    <div class="carousel-inner" id="carousel-content">
    </div>
    <a class="carousel-control-prev" href="#carouselExample" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#carouselExample" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>
  </div>
</div>
      

<!-- Modal for Editing -->
<div id="editModal" class="modal" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="editForm">
        <div class="modal-header">
          <h5 class="modal-title">Edit Data Barang</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label for="deviceEdit">Device</label>
            <input type="text" class="form-control" id="deviceEdit" required>
          </div>
          <div class="form-group">
            <label for="powerEdit">Power (Watt)</label>
            <input type="number" class="form-control" id="powerEdit" required>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Update</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal for Deleting -->
<div id="deleteModal" class="modal" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="deleteForm">
        <div class="modal-header">
          <h5 class="modal-title">Delete Data Barang</h5>
          <button type="button" class="close" data-dismiss="modal">
            <span>&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete this item?</p>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-danger">Delete</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>


    </div>

    <!-- Include Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
      const urlParams = new URLSearchParams(window.location.search);
      const message = urlParams.get("login");

      if (message == "yes") {
        alert(`Selamat Datang kak ${localStorage.getItem("namaCustomer")} di Aplikasi HEtrik`);
      }

      async function fetchDataDashboard() {
        try {
          // Fetch data for Pelanggan (you can replace this with an actual API call)
        //   const pelangganData = {
        //     labels: ["Jan", "Feb", "Mar", "Apr", "May"],
        //     datasets: [
        //       {
        //         label: "Pelanggan",
        //         data: [200, 350, 450, 600, 800],
        //         backgroundColor: "rgba(75, 192, 192, 0.2)",
        //         borderColor: "rgba(75, 192, 192, 1)",
        //         borderWidth: 1,
        //       },
        //     ],
        //   };

          // Fetch data for Barang (from your API)
          const response = await fetch("https://652a45e54791d884f1fcb765.mockapi.io/barang");
          const data = await response.json();

          const totalBarangElement = document.getElementById("totalBarang");
          totalBarangElement.textContent = data.length;

          const barangData = data.map((barang) => barang.power);

          const barangNama = data.map((barang) => barang.device);
          // Update Pelanggan Chart (you can replace the chart ID)
          const pelangganChart = new Chart(document.getElementById("barangChart"), {
            type: "bar", // Change the chart type to bar
            data: {
              labels: barangNama,
              datasets: [
                {
                  label: "Power",
                  data: barangData,
                  backgroundColor: "rgba(255, 99, 132, 0.2)",
                  borderColor: "rgba(255, 99, 132, 1)",
                  borderWidth: 1,
                },
              ],
            },
          });

          // Sample data for Listrik Hemat
          var electricityData = {
            labels: ["Jan", "Feb", "Mar", "Apr", "May"],
            datasets: [
              {
                label: "Listrik Hemat (kWh)",
                data: [500, 700, 600, 800, 750],
                backgroundColor: "rgba(255, 99, 132, 0.2)",
                borderColor: "rgba(255, 99, 132, 1)",
                borderWidth: 1,
              },
            ],
          };

          // Update Listrik Hemat Chart
          var electricityChart = new Chart(
            document.getElementById("electricityChart"),
            {
              type: "line",
              data: electricityData,
            }
          );
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      // Fetch and update data
      fetchDataDashboard();

//       document.addEventListener("DOMContentLoaded", function () {
//   const carouselContent = document.getElementById("carousel-content");
//   const apiUrl = "https://652a45e54791d884f1fcb765.mockapi.io/barang";

//   // Function to fetch data from the API
//   async function fetchData() {
//     try {
//       const response = await fetch(apiUrl);
//       const data = await response.json();
//       return data;
//     } catch (error) {
//       console.error("Error fetching data:", error);
//       return [];
//     }
//   }

//   // Function to create a carousel item containing multiple cards
  function createCarouselItem(cards, active) {
    const carouselItem = document.createElement("div");
    carouselItem.classList.add("carousel-item");
    if (active) {
      carouselItem.classList.add("active");
    }

    const rowDiv = document.createElement("div");
    rowDiv.classList.add("row");

    cards.forEach((cardData) => {
      const { device, power ,avatar,id} = cardData;
      console.log(cardData)
      const cardDiv = document.createElement("div");
      cardDiv.classList.add("col-md-4"); // 3 cards per row

      cardDiv.innerHTML = `
        <div class="card">
          <img src="${avatar}" class="card-img-center" alt="${device}"> <!-- Image added here -->
          <div class="card-body">
            <h5 class="card-title">${device}
              </h5>
            <p class="card-text"> Power ${power} watt 
              <button class="btn btn-primary btn-sm bt-a" data-id="${id}" >Edit</button> <!-- Added Delete button -->
              <button class="btn btn-danger btn-sm bt-b" data-id="${id}" >Delete</button> <!-- Added Delete button -->
              </p>
          </div>
        </div>
      `;

      rowDiv.appendChild(cardDiv);
    });



    carouselItem.appendChild(rowDiv);
    return carouselItem;
  }

//   // Function to populate the carousel with data
//   async function populateCarousel() {
//     const data = await fetchData();
//     carouselContent.innerHTML = "";

//     // Split the data into groups of 3 for each carousel item
//     for (let i = 0; i < data.length; i += 3) {
//       const cardGroup = data.slice(i, i + 3);
//       const active = i === 0;
//       const carouselItem = createCarouselItem(cardGroup, active);
//       carouselContent.appendChild(carouselItem);
//     }
//   }

//   // Call the function to populate the carousel when the document is loaded
//   populateCarousel();
// });


document.addEventListener("DOMContentLoaded", function () {
  const carouselContent = document.getElementById("carousel-content");
  const apiUrl = "https://652a45e54791d884f1fcb765.mockapi.io/barang";
  const editModal = document.getElementById("editModal");
  const editForm = document.getElementById("editForm");
  const deleteModal = document.getElementById("deleteModal");
  const deleteForm = document.getElementById("deleteForm");
  let itemToDelete; // Untuk menyimpan data barang yang akan dihapus

  // Function to fetch data from the API
  async function fetchData() {
    try {
      const response = await fetch(apiUrl);
      const data = await response.json();
      return data;
    } catch (error) {
      console.error("Error fetching data:", error);
      return [];
    }
  }

  // Function to create a carousel item containing multiple cards
  // ...

  // Function to populate the carousel with data
  async function populateCarousel() {
    const data = await fetchData();
    carouselContent.innerHTML = "";

    // Split the data into groups of 3 for each carousel item
    for (let i = 0; i < data.length; i += 3) {
      const cardGroup = data.slice(i, i + 3);
      const active = i === 0;
      const carouselItem = createCarouselItem(cardGroup, active);
      carouselContent.appendChild(carouselItem);
    }
  }

  carouselContent.addEventListener("click", function (event) {
    // console.log(event.target.classList.contains("btn-danger"))
    if (event.target.classList.contains("bt-a")) {
      const id = event.target.getAttribute("data-id");
      const itemToEdit = id /* Fetch the item to edit based on the ID */;
      openEditModal(itemToEdit);
    }
  });

  // Event listener for opening the delete modal
  carouselContent.addEventListener("click", function (event) {
    
    if (event.target.classList.contains("bt-b")) {
      console.log(event.target)
      const id = event.target.getAttribute("data-id");
      const itemToDelete = id/* Fetch the item to delete based on the ID */;
      openDeleteModal(itemToDelete);
    }
  });

  // Function to open the edit modal

  async function openEditModal(barang) {
  const response = await fetch(`https://652a45e54791d884f1fcb765.mockapi.io/barang/${barang}`);
  const data = await response.json();

  if (response.ok) {
    // Set values in the edit form
    editModal.querySelector("#deviceEdit").value = data.device;
    editModal.querySelector("#powerEdit").value = data.power;
    editModal.style.display = "block";

    // Handle the form submission to update the data
    editForm.onsubmit = async (event) => {
      event.preventDefault();
      const updatedData = {
        device: editModal.querySelector("#deviceEdit").value,
        power: editModal.querySelector("#powerEdit").value,
      };

      try {
        const updateResponse = await fetch(
          `https://652a45e54791d884f1fcb765.mockapi.io/barang/${barang}`,
          {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(updatedData),
          }
        );

        if (updateResponse.ok) {
          // Update the UI here if needed
          alert("Data updated successfully!");
          openEditModal(); // Close the modal
          location.reload();
          // populateCarousel(); // Refresh the carousel
        } else {
          alert("Failed to update data.");
        }
      } catch (error) {
        console.error("Error updating data:", error);
        alert("An error occurred while updating data.");
      }
    };
  } else {
    alert("Failed to fetch data for editing.");
  }
}
  // Function to open the delete modal
  function openDeleteModal(barang) {
    itemToDelete = barang; // Save the item to delete
    deleteModal.style.display = "block";

    // Handle the form submission to delete the data
    deleteForm.onsubmit = async (event) => {
      event.preventDefault();
      try {
        const response = await fetch(`${apiUrl}/${itemToDelete}`, {
          method: "DELETE",
        });
        if (response.ok) {
          // Update the UI here if needed
          alert("Data deleted successfully!");
          // openDeleteModal(); // Close the modal
          deleteModal.style.display = "none";

          populateCarousel(); // Refresh the carousel
        } else {
          alert("Failed to delete data.");
        }
      } catch (error) {
        console.error("Error deleting data:", error);
        alert("An error occurred while deleting data.");
      }
    };
  }

  // Call the function to populate the carousel when the document is loaded
  populateCarousel();
});


</script>
  </body>
</html>
